<html>
<head>
  <title>SoundBox demo</title>
  <style type="text/css">
body {
  font-family: arial, sans-serif;
  background: #000;
  color: #fff;
}
  </style>
  <script type="text/javascript" src="Blob.js"></script>
  <script type="text/javascript" src="player-small.js"></script>
  <script type="text/javascript">
function startDemo() {
  //----------------------------------------------------------------------------
  // Music data section
  //----------------------------------------------------------------------------

  // Song data
var song={songData:[{i:[0,255,128,0,0,255,128,1,1,0,0,6,29,0,128,4,1,3,88,226,59,255,147,6,44,4],p:[1,1,1,1,1,1,1,1,,,1,1,1,1,1,1,1,1,1,1,1,1,,,2,2,2,2],c:[{n:[123,135,,138,126,,140,128,123,135,,138,126,,130,142,123,135,,145,133,,144,132,130,142,,128,140,,138,137],f:[]},{n:[147,,150,,154,,152,,135,,138,,142,,140,,147,,150,,154,,157,,145,,144,,138,,140],f:[]}]},{i:[2,255,128,0,2,154,128,2,0,0,11,5,95,1,182,6,1,2,40,193,35,55,47,3,0,2],p:[,,,,,2,1,1,1,1,1,1,3,3,1,3,1,1,1,1,1,1,1,1,1,1],c:[{n:[123,, ,,,,138,,,,128,,,,116,,121,,,,,,126,,,,130,,,,135],f:[22,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,55]},{n:[,,,,,,,,,,,,,,,,,,,,,,,,,,,,111],f:[,,,,,,,,,,,,,,,,,,,,,,,,,,,,22,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,29]},{n:[,,,,,,,,,,,,,,135,,,,,,,,,,,,111,,,,135],f:[]}]},{i:[0,192,104,1,0,80,99,0,0,0,4,0,66,3,0,0,0,1,0,1,2,17,37,4,0,0],p:[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,1,1,1,1,1,1,1,1,1],c:[{n:[147,,,,,,147,,147,,,,135,,,,147,,,,,,147,,147,,,,135],f:[]},{n:[,,,,,,,,,,,,,,,,,,,,147,,,,,,147,,147],f:[]}]},{i:[3,192, 128,0,3,192,140,18,1,0,107,115,138,1,136,5,1,3,179,92,49,100,71,5,101,4],p:[,,1,2,1,2,1,2,1,2,1,2,,,,,1,2,,,1,2,,,1],c:[{n:[111],f:[]},{n:[114],f:[]}]},{i:[0,0,140,0,0,0,140,0,0,36,4,10,34,0,187,5,0,1,239,135,0,32,108,5,16,4],p:[,,1,1,1,1,1,1,1,1,1,1,1,1,,,1,1,1,1,1,1,2,2,1,1],c:[{n:[,,,,147,147,,,,,,,147,,,,,,,,147,147,,,,,147,,,,147],f:[]},{n:[,,147,,,,147,,,,147,,,,147,,,,147,,,,147,,,,147,,,,147],f:[]}]},{i:[3,100,140,0,3,201,116,8,0,0,0,19,44,3,127,8,1,3,102,126,20,51,111,3,79,4],p:[,,,,1,2, 3,,1,2,1,2,,,4,2,4,2,5,6,5,6,7,8,5,6],c:[{n:[154,135,154,130,,,152,,,,,,,,150,149,150,138,152,128,,,149,,,,,,147],f:[1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,3]},{n:[142,,,,,,154,152,154,,,,,,,,159,135,159,128,,,157,142,157,130,,,157,,152],f:[]},{n:[142,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,130],f:[]},{n:[154,135,154,130,,,152,,,,,,,,150,149,150,138,152,128,,,149,,,,,,147],f:[1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1]},{n:[,,135,,,,,,135,,,,,,,,,,135,,,,,,135,,,,,,,,,,138,,,,,,138,,,,,,,,,,138,,,,,,138,,,,,,,,,,142,,, ,,,142,,,,,,,,,,140,,,,,,140],f:[1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,3]},{n:[,,135,,,,,,135,,,,,,,,,,147,,,,,,145,,,,,,,,,,138,,,,,,138,,,,,,,,,,138,,,,,,138,,,,,,,,,,142,,,,,,142,,,,,,,,,,140,,,,,,140],f:[]},{n:[,,135,,,,,,135,,,,,,,,,,135,,,,,,135,,,,,,,,,,138,,,,,,138,,,,,,,,,,138,,,,,,138,,,,,,,,,,142,,,,,,142,,,,,,,,,,140,,,,,,140,,,,,,,,154,135,154,130,,,152,,,,,,,,150,149,150,138,152,128,,,149,,,,,,147],f:[]},{n:[,,135,,,,,,135,,,,,,,,,,147,,,,,,145,,,,,,,,,,138,,,,,,138,,,,,,,,,,138,,,,,,138, ,,,,,,,,,142,,,,,,142,,,,,,,,,,140,,,,,,140,,,,,,,,142,,,,,,154,152,154,,,,,,,,159,135,159,128,,,157,142,157,130,,,157,,152],f:[]}]},{i:[1,255,92,0,1,255,92,0,0,0,0,0,5,0,159,4,1,3,91,182,5,97,91,4,44,4],p:[,1,,,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2],c:[{n:[,,,,147,,,,,,,,147,,,,,,,,147,,,,,,,,147],f:[]},{n:[,,,159,159,,,,,147,,147,,,,,147,,,159,159,,,,,147,,147,,,159],f:[]}]},{i:[3,146,140,0,1,224,128,3,0,0,92,0,95,3,179,6,1,3,17,135,11,12,150,3,157,6],p:[,,,,,,,,,,,,,,,,,,1,2,,,1,2,1, 3,1,2,3],c:[{n:[135,,,123],f:[]},{n:[138,,,126],f:[]},{n:[133,,,121,,,,,,,,,,,145],f:[]}]}],rowLen:5513,endPattern:30};

  //----------------------------------------------------------------------------
  // Demo program section
  //----------------------------------------------------------------------------

  // Initialize music generation (player).
  var t0 = new Date();
  var player = new CPlayer();
  player.init(song);

  // Generate music...
  var done = false;
  setInterval(function () {
    if (done) {
      return;
    }

    var s = document.getElementById("status");
    s.textContent = s.textContent + ".";

    done = player.generate() >= 1;

    if (done) {
      var t1 = new Date();
      s.textContent = s.textContent + "done (" + (t1 - t0) + "ms)";

      // Put the generated song in an Audio element.
      var wave = player.createWave();
      var audio = document.createElement("audio");
      audio.src = URL.createObjectURL(new Blob([wave], {type: "audio/wav"}));
      audio.play();

      // Start an oscilloscope animation.
      var ctx = document.getElementById("canvas").getContext("2d");
      setInterval(function () {
        // Get currently playing data.
        var t = audio.currentTime;
        var data = player.getData(t, 300);

        // Clear background.
        ctx.fillStyle = "rgb(0,30,0)";
        ctx.fillRect(0, 0, 300, 200);
        ctx.fillStyle = "rgb(0,30,60)";
        ctx.fillRect(0, 0, 300 * (t / audio.duration), 200);

        ctx.strokeStyle = "rgb(255,255,255)";

        // Plot left channel.
        ctx.beginPath();
        ctx.moveTo(0, 50 + 50 * data[0]);
        for (var k = 1; k < 300; ++k) {
          ctx.lineTo(k, 50 + 50 * data[k * 2]);
        }
        ctx.stroke();

        // Plot right channel.
        ctx.beginPath();
        ctx.moveTo(0, 150 + 50 * data[1]);
        for (var k = 1; k < 300; ++k) {
          ctx.lineTo(k, 150 + 50 * data[k * 2 + 1]);
        }
        ctx.stroke();
      }, 16);
    }
  }, 0);
}
  </script>
</head>
<body onload="startDemo();">
<h1>SoundBox demo</h1>
<p id="status">Generating</p>
<canvas id="canvas" width="300" height="200" />
</body>
</html>

